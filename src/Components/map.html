

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Morocco Map with City Data</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #f0f0f0;
      font-family: sans-serif;
    }

    .map {
      border: 1px solid black;
      background-color: white;
    }

    .country {
      fill: lightgreen;
      stroke: black;
      stroke-width: 1px;
    }

    .city-circle {
      fill: red;
      stroke: black;
      stroke-width: 1px;
      cursor: pointer;
    }

    canvas {
      margin-top: 20px;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <div class="map"></div>
  <canvas id="cityChart"></canvas>

<script>
  const width = 600;
  const height = 600;

  const svg = d3.select('.map')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

  const g = svg.append('g');

  // Morocco projection
  const projection = d3.geoMercator()
                       .center([-7, 31])
                       .scale(2000)
                       .translate([width / 2, height / 2]);

  const path = d3.geoPath().projection(projection);

  // Moroccan cities with coordinates and sample percentages
  const cities = [
    { name: "Casablanca", lon: -7.5898, lat: 33.5731, value: 25 },
    { name: "Rabat", lon: -6.8498, lat: 34.0209, value: 20 },
    { name: "Marrakesh", lon: -7.9811, lat: 31.6340, value: 15 },
    { name: "Fes", lon: -4.999, lat: 34.0331, value: 10 },
    { name: "Tangier", lon: -5.812, lat: 35.7595, value: 30 }
  ];

  // Load world TopoJSON and draw Morocco
  d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2.0.2/countries-110m.json')
    .then(data => {
      const countries = topojson.feature(data, data.objects.countries).features;
      const morocco = countries.filter(d => d.id === "504");

      // Draw Morocco
      g.selectAll('path')
       .data(morocco)
       .enter()
       .append('path')
       .attr('class', 'country')
       .attr('d', path);

      // Draw cities
      g.selectAll('circle')
       .data(cities)
       .enter()
       .append('circle')
       .attr('class', 'city-circle')
       .attr('cx', d => projection([d.lon, d.lat])[0])
       .attr('cy', d => projection([d.lon, d.lat])[1])
       .attr('r', 6)
       .on('mouseover', function(event, d) {
         d3.select(this).attr('r', 10); // highlight on hover
       })
       .on('mouseout', function(event, d) {
         d3.select(this).attr('r', 6);
       })
       .on('click', function(event, d) {
         // Update chart when city is clicked
         cityChart.data.datasets[0].data = cities.map(c => c.name === d.name ? c.value : 0);
         cityChart.update();
       });
    })
    .catch(error => console.error(error));

  // Initialize Chart.js
  const ctx = document.getElementById('cityChart').getContext('2d');
  const cityChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: cities.map(c => c.name),
      datasets: [{
        label: 'Percentage',
        data: cities.map(c => c.value),
        backgroundColor: ['#4caf50','#2196f3','#ff9800','#e91e63','#9c27b0']
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: { enabled: true }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
</script>
</body>
</html>
